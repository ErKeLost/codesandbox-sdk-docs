---
title: Preview Tokens
description: Learn about preview tokens in CodeSandbox SDK.
---

import { Callout } from 'nextra-theme-docs'

# Preview Tokens

If a sandbox is private, its previews won't be accessible unless a preview token is provided. A preview token can be provided through:

- The url: `https://:id-:port.csb.app?preview_token=:token`
- A header: `csb-preview-token: :token`
- A cookie: `csb_preview_token=:token`

You can obtain a preview token by calling `sandbox.previewTokens.create`. You can also set a custom expiration time for the token:

```ts
const sandbox = await sdk.sandbox.resume('some-id')
const previewToken = await sandbox.previewTokens.create({
  expiresAt: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7), // 1 week from now
})

// Pass in the port and token to create the url for
const signedUrl = sandbox.previewTokens.getSignedPreviewUrl(3000, previewToken.token)

// This URL will have access to the sandbox until the token expires
console.log(signedUrl);
```

<Callout>
When you open a signed URL in the browser, we will automatically put the preview token in a
cookie so subsequent requests from the same browser don't require the token.
</Callout>

If you want to revoke a token, you can call `sandbox.previewTokens.list` to get the token's ID and then call `sandbox.previewTokens.revoke` with the ID.

### Managing Preview Tokens (CLI)

The CLI allows you to manage preview tokens of a sandbox. You can list, revoke and update preview tokens.

```
$ csb sandbox preview-tokens :sandbox-id list
 ID                           PREFIX        LAST USED   EXPIRES
 prv_Hca52PUyFHVJsGkciXXbEq   prv_v1_8uKY   Never       Never
 prv_HbE8wC6veXWwcazFYrdUfy   prv_v1__ki7   Never       Never
 prv_MWMhMjbQiY3jSagfaG6D7R   prv_v1_i7iI   Never       Never
```

You can also revoke a preview token this way:

```
$ csb sandbox preview-tokens :sandbox-id revoke prv_Hca52PUyFHVJsGkciXXbEq
```

If you want to revoke all preview tokens for a sandbox, you can do so with:

```
$ csb sandbox preview-tokens :sandbox-id revoke --all
```

And you can update the expiration time of a preview token:

```
$ csb sandbox preview-tokens :sandbox-id update prv_Hca52PUyFHVJsGkciXXbEq --expires-at 2025-03-01
```

### Running from the Browser

When you use the SDK [in the browser](https://codesandbox.io/docs/sdk/sandboxes#opening-a-sandbox-from-the-browser), you cannot generate a preview token from the browser, because it requires an API key.

Instead, you can generate a preview token on the server, and then pass that to the browser.

```ts

export const POST = async ({ params, body }) => {
  const sandbox = sdk.sandbox.ref(params.id)
  const previewToken = await sandbox.previewTokens.create();

  return sandbox.previewTokens.getSignedPreviewUrl(body.port, previewToken.token)
}

// In the browser ask for the signed url when it makes most sense, here
// asking for it while waiting for the port to open
const [signedUrl] = await Promise.all([
  fetchSignedUrlFromServer(3000),
  client.ports.waitForPort(3000)
])
```

### Using the Token for API Requests

In some cases, a private sandbox might be running an API server that you want to access. In those cases, you should put the preview token in the `csb-preview-token` header.

```ts
const sandbox = await sdk.sandbox.create()
const client = await sandbox.connect()

// Start a development server
client.shells.run("npm run dev");

// Wait for the dev server port to open
const portInfo = await client.ports.waitForPort(3000);

// Generate the preview token
const previewToken = await sandbox.previewTokens.create();
const url = 'https://' + portInfo.url

const response = await fetch(url, {
  headers: {
    'csb-preview-token': previewToken.token,
  },
});
```
