---
title: Previews
description: Learn how you can interact with previews in your sandbox.
---

import { Callout } from 'nextra-theme-docs'

# Previews

The previews API allows you to create and interact with previews in the browser. You can navigate, listen to messages and even inject custom code into the preview.

<Callout>
The previews only works in the browser session.
</Callout>

## API

```ts
const session = await connectToSandbox({
    id: sandboxId,
    getSession: (id) => fetchJson('/browser-sessions/' + id)
})

const port = await session.ports.waitForPort(5173)
const preview = session.previews.create('https://' + port.url)

document.querySelector('#preview-container').append(preview.iframe)
```

## Messages

You can listen to messages from the preview:

```ts
preview.onMessage((message) => {
    switch (message.type) {
        case 'SET_URL': {
            // Url that was set
            message.url
            // If you can move backward
            message.back
            // If you can move forward
            message.forward
            break;
        }
        case 'RELOAD': {
            // If preview reloaded
        }
        case 'PREVIEW_UNLOADING': {
            // Preview will unload
        }
    }
})
```

<Callout>
By injecting your own code you can extend these messages to your own.
</Callout>

## Navigate

```ts
// Replace the current url
preview.setUrl("...")

// Navigate back
preview.back()

// Navigate forward
preview.forward()

// Reload the iframe
preview.reload()
```

## Inject and Invoke

You can inject any code into the preview. This is useful if you want to insert custom UI, background processes etc. The injected code has access to listening to messages, sending messages and any variables (scope) you send to the injected code.

```ts
preview.onMessage((message) => {
    console.log(message)
})

preview.injectAndInvoke(function MyInjectedFunction({ previewProtocol, previewWindow, scope }) {
    alert(scope.message)
    previewProtocol.sendMessage({ type: 'ALERTED' })
}, {
    message: 'Hello World'
})
```
